<!DOCTYPE html>
<html>
    <head>
        <title>POI-Suche in Bochum</title>
    
        <meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"  />
        <link rel="stylesheet" href="css/leaflet1.0.2.css" />
        <link rel="stylesheet" type="text/css" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/label.css" />
		<link rel="stylesheet" href="css/leaflet-search.css" />	
		<link rel="stylesheet" href="css/easy-button.css" />
		<link rel="stylesheet" href="css/leaflet-gps.css" />
		<link rel="stylesheet" href="css/Control.Loading.css" />
		<script src="js/leaflet1.0.2.js"></script>
        <script src="js/label.js"></script>
        <script src="js/Autolinker.min.js"></script>
		<script src="js/leaflet-search.js"></script>
		<script src="js/easy-button.js"></script>
		<script src="js/Control.Loading.js"></script>
		
		
    </head>
    <body>
        <div id="map"></div>
        <script src="data/json_Alle.js"></script>
		<script src="js/leaflet-search.js"></script>
		<script src="js/easy-button.js"></script>
		<script src="js/leaflet-gps.js"></script>
		<link rel="stylesheet" href="css/leaflet-search.css" />	
		<link rel="stylesheet" href="css/easy-button.css" />
        <script>

		//Einrichtung der Basiskarte
		var map = L.map('map', { zoomControl:false }).setView([51.4513690683,7.27304188159], 12);
       	var basemap = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
		maxZoom: 16,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.streets'
		}).addTo(map);
	
		//Einrichtung des Loaders
		var loadingControl = L.Control.loading({
                    separate: true
                });
                map.addControl(loadingControl);
	
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	
	
        var feature_group = new L.featureGroup([]);
        var bounds_group = new L.featureGroup([]);
        var raster_group = new L.LayerGroup([]);
	
	
        var layerOrder = new Array();
        function restackLayers() {
            for (index = 0; index < layerOrder.length; index++) {
                layerOrder[index].bringToFront();
            }
        }
        map.on('overlayadd', restackLayers);
        layerControl = L.control.layers({},{},{collapsed:false});
		
	

	   //Hervorheben der Layer-Informationen auf der Karte
		var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;
            highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
            });

            if (!L.Browser.ie && !L.Browser.opera) {
                highlightLayer.bringToFront();
            }
        }

        
		//Einrichtung aller Ober- und Unterkategorien: Anzeige der PopUps, Hervorheben bei MouseOver, Punktdarstellung auf der Karte, Deklarierung als geoJason zum entschlüsseln und darstellen der enthaltenen Objekte
        function pop_Alle(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    layer.setStyle(doStyleAlle(feature));

                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table><tr><th scope="row">BEZ</th><td>' + Autolinker.link(String(feature.properties['BEZ'])) + '</td></tr><tr><th scope="row">NAME</th><td>' + Autolinker.link(String(feature.properties['NAME'])) + '</td></tr><tr><th scope="row">TELEFON</th><td>' + Autolinker.link(String(feature.properties['TELEFON'])) + '</td></tr><tr><th scope="row">OEFFNUNG</th><td>' + Autolinker.link(String(feature.properties['OEFFNUNG'])) + '</td></tr><tr><th scope="row">WWW</th><td>' + Autolinker.link(String(feature.properties['WWW'])) + '</td></tr><tr><th scope="row">EMAIL</th><td>' + Autolinker.link(String(feature.properties['EMAIL'])) + '</td></tr><tr><th scope="row">STRASSE</th><td>' + Autolinker.link(String(feature.properties['STRASSE'])) + '</td></tr><tr><th scope="row">ORT</th><td>' + Autolinker.link(String(feature.properties['ORT'])) + '</td></tr><tr><th scope="row">BEMERKUNG</th><td>' + Autolinker.link(String(feature.properties['BEMERKUNG'])) + '</td></tr><tr><th scope="row">PLZ</th><td>' + Autolinker.link(String(feature.properties['PLZ'])) + '</td></tr><tr><th scope="row">Hkat</th><td>' + Autolinker.link(String(feature.properties['Hkat'])) + '</td></tr><tr><th scope="row">Nkat</th><td>' + Autolinker.link(String(feature.properties['Nkat'])) + '</td></tr></table>';
            layer.bindPopup(popupContent);
        }

        function doStyleAlle() {
            return {
                radius: 4.0,
                fillColor: '#e31a1c',
                color: '#000000',
                weight: 0.0,
                opacity: 1.0,
                dashArray: '',
                fillOpacity: 1.0
            }
        }
        function doPointToLayerAlle(feature, latlng) {
            return L.circleMarker(latlng, doStyleAlle())
        }
        var json_AlleJSON = new L.geoJson(json_Alle, {
            onEachFeature: pop_Alle, 
            pointToLayer: doPointToLayerAlle
            });

			


	//Einrichtung des Maßstabes	   
	   L.control.scale({options: {position: 'bottomleft',maxWidth: 100,metric: true,imperial: false,updateWhenIdle: false}}).addTo(map);
  

	//Einrichtung der Suchmaske nach Inhabernamen
	var searchName = new L.Control.Search({layer: L.featureGroup([json_AlleJSON]) ,
	textPlaceholder: 'Bitte einen "Namen" in die Suchmaske eingeben     ',
	propertyName: 'NAME',
	circleLocation:true ,
	zoom: null});
	searchName.on('search_locationfound', function(e) {
    e.layer.setStyle({fillColor: 'yellow', color: 'yellow', fillOpacity: 1});
	}).on('search_collapsed', function(f) {
    json_AlleJSON.eachLayer(function(layer) {
        json_AlleJSON.resetStyle(layer);
    });
	});
	map.addControl( searchName );
	
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


	//GPS-Control einrichten
	map.addControl( new L.Control.Gps({autoActive:false}) );						//inizialize control-GPS
	
    </script>

</body>
</html>